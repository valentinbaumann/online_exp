<!DOCTYPE html>

<html lang="de">

<head>

  <meta charset="UTF-8"/>
  
  <!-- name of experiment -->
  <title>offline_test_Day1</title>  
  
  <!-- loads jspsych plugins (offline) -->
  <script type="text/javascript" src="jspsych-6.0.5/jspsych.js"></script>
  <link rel="stylesheet" type="text/css" href="jspsych-6.0.5/css/jspsych.css"/>
  <script type="text/javascript" src="jspsych-6.0.5/plugins/jspsych-html-keyboard-response.js"></script>
  <script type="text/javascript" src="jspsych-6.0.5/plugins/jspsych-image-keyboard-response.js"></script>
	<script type="text/javascript" src="jspsych-6.0.5/plugins/jspsych-html-button-response.js"></script>
	<script type="text/javascript" src="jspsych-6.0.5/plugins/jspsych-html-keyboard-response.js"></script>
	<script type="text/javascript" src="jspsych-6.0.5/plugins/jspsych-fullscreen.js"></script>
  <script src="jspsych-6.0.5/plugins/jspsych-survey-text.js"></script> 

</head>



<!-- this is the Javascript section -->
<script>
  


	///////////////////////////////////////////////////////
	// define variables

	// create timeline
	var timeline = [];

	var console_test = "go console!";
	console.log(console_test);
  
	// create encoding condition variable
	var encoding_condition_array = ["incidental_semantic", "incidental_perceptual", "intentional"]
	encoding_condition_array = jsPsych.randomization.shuffle(encoding_condition_array)    // shuffle array
	
	// create rehearsal condition variable
	var rehearsal_condition_array = ["STM", "noSTM"]
	rehearsal_condition_array = jsPsych.randomization.shuffle(rehearsal_condition_array)    // shuffle array
	
	var rehearsal_condition = rehearsal_condition_array[0]      // get first element
	jsPsych.data.addProperties({rehearsal_condition: rehearsal_condition});	// adds condition variable to all trials in the data
	console.log("rehearsal_condition: " + rehearsal_condition);

	// add day varaible to the data 
	jsPsych.data.addProperties({day: "day1"});

	// prepare learning lists for the three conditions
	var words_learning_incidental_semantic = [
		{word: 'ENTE', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_semantic", target: "living"}},
		{word: 'RAUPE', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_semantic", target: "living"}},
		{word: 'BAUER', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_semantic", target: "living"}},
		{word: 'VOGEL', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_semantic", target: "living"}},
		{word: 'MALER', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_semantic", target: "living"}},
		{word: 'FISCH', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_semantic", target: "living"}},		
		{word: 'ROBBE', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_semantic", target: "living"}},
		{word: 'BRAUT', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_semantic", target: "living"}},
		{word: 'ZIEGE', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_semantic", target: "living"}},		
		{word: 'KROKODIL', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_semantic", target: "living"}},
		{word: 'TOURIST', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_semantic", target: "living"}},
		{word: 'ONKEL', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_semantic", target: "living"}},	
		{word: 'AAL', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_semantic", target: "living"}},	
		{word: 'GANS', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_semantic", target: "living"}},			
		{word: 'SOHN', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_semantic", target: "living"}},	
		
		{word: 'BESTECK', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_semantic", target: "non_living"}},
		{word: 'PADDEL', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_semantic", target: "non_living"}},
		{word: 'SCHULE', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_semantic", target: "non_living"}},
		{word: 'KIESEL', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_semantic", target: "non_living"}},		
		{word: 'ZOPF', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_semantic", target: "non_living"}},
		{word: 'BURG', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_semantic", target: "non_living"}},
		{word: 'GABEL', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_semantic", target: "non_living"}},		
		{word: 'TEPPICH', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_semantic", target: "non_living"}},
		{word: 'TASCHE', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_semantic", target: "non_living"}},
		{word: 'FEDER', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_semantic", target: "non_living"}},		
		{word: 'SALBE', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_semantic", target: "non_living"}},
		{word: 'PEDAL', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_semantic", target: "non_living"}},
		{word: 'RAHMEN', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_semantic", target: "non_living"}},		
		{word: 'FLAGGE', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_semantic", target: "non_living"}},
		{word: 'KOHLE', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_semantic", target: "non_living"}},
	];
	words_learning_incidental_semantic = jsPsych.randomization.shuffle(words_learning_incidental_semantic) ;			// shuffle learning list
	
	var words_learning_incidental_perceptual = [
		{word: 'UNKRAUT', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_perceptual", target: "no_e"}},
		{word: 'MILCH', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_perceptual", target: "no_e"}},
		{word: 'KÜRBIS', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_perceptual", target: "no_e"}},
		{word: 'FÖHN', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_perceptual", target: "no_e"}},
		{word: 'KOMPASS', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_perceptual", target: "no_e"}},
		{word: 'ZAHN', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_perceptual", target: "no_e"}},		
		{word: 'FABRIK', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_perceptual", target: "no_e"}},
		{word: 'GOLD', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_perceptual", target: "no_e"}},
		{word: 'PILZ', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_perceptual", target: "no_e"}},		
		{word: 'PILOT', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_perceptual", target: "no_e"}},
		{word: 'HAUS', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_perceptual", target: "no_e"}},
		{word: 'DACHS', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_perceptual", target: "no_e"}},
		{word: 'SAUNA', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_perceptual", target: "no_e"}},
		{word: 'PANDA', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_perceptual", target: "no_e"}},
		{word: 'TURM', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_perceptual", target: "no_e"}},
		
		{word: 'RIESE', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_perceptual", target: "e"}},
		{word: 'GURKE', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_perceptual", target: "e"}},
		{word: 'MEISE', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_perceptual", target: "e"}},
		{word: 'MAPPE', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_perceptual", target: "e"}},
		{word: 'PULLOVER', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_perceptual", target: "e"}},
		{word: 'JACKE', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_perceptual", target: "e"}},
		{word: 'ANGEL', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_perceptual", target: "e"}},
		{word: 'LUPE', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_perceptual", target: "e"}},
		{word: 'PFANNE', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_perceptual", target: "e"}},
		{word: 'LEDER', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_perceptual", target: "e"}},
		{word: 'DAME', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_perceptual", target: "e"}},
		{word: 'FEILE', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_perceptual", target: "e"}},
		{word: 'PUPPE', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_perceptual", target: "e"}},
		{word: 'RUDER', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_perceptual", target: "e"}},	
		{word: 'ORGEL', data: {trial_code: 'learning', block: 99, encoding_condition: "incidental_perceptual", target: "e"}},
	];
	words_learning_incidental_perceptual = jsPsych.randomization.shuffle(words_learning_incidental_perceptual) ;		// shuffle learning list
	
	var words_learning_intentional = [
		{word: 'AMPEL', data: {trial_code: 'learning', block: 99, encoding_condition: "intentional"}},
		{word: 'AUGE', data: {trial_code: 'learning', block: 99, encoding_condition: "intentional"}},
		{word: 'BANK', data: {trial_code: 'learning', block: 99, encoding_condition: "intentional"}},
		{word: 'BAUM', data: {trial_code: 'learning', block: 99, encoding_condition: "intentional"}},
		{word: 'BIENE', data: {trial_code: 'learning', block: 99, encoding_condition: "intentional"}},
		{word: 'BRIEF', data: {trial_code: 'learning', block: 99, encoding_condition: "intentional"}},
		{word: 'BRILLE', data: {trial_code: 'learning', block: 99, encoding_condition: "intentional"}},
		{word: 'BROT', data: {trial_code: 'learning', block: 99, encoding_condition: "intentional"}},
		{word: 'EIMER', data: {trial_code: 'learning', block: 99, encoding_condition: "intentional"}},
		{word: 'FENSTER', data: {trial_code: 'learning', block: 99, encoding_condition: "intentional"}},
		{word: 'FLASCHE', data: {trial_code: 'learning', block: 99, encoding_condition: "intentional"}},
		{word: 'GEMÜSE', data: {trial_code: 'learning', block: 99, encoding_condition: "intentional"}},
		{word: 'HAFEN', data: {trial_code: 'learning', block: 99, encoding_condition: "intentional"}},
		{word: 'HAND', data: {trial_code: 'learning', block: 99, encoding_condition: "intentional"}},
		{word: 'HEMD', data: {trial_code: 'learning', block: 99, encoding_condition: "intentional"}},
		{word: 'IGEL', data: {trial_code: 'learning', block: 99, encoding_condition: "intentional"}},
		{word: 'KATZE', data: {trial_code: 'learning', block: 99, encoding_condition: "intentional"}},
		{word: 'KLASSE', data: {trial_code: 'learning', block: 99, encoding_condition: "intentional"}},
		{word: 'KREUZ', data: {trial_code: 'learning', block: 99, encoding_condition: "intentional"}},
		{word: 'LEHRER', data: {trial_code: 'learning', block: 99, encoding_condition: "intentional"}},
		{word: 'MÄDCHEN', data: {trial_code: 'learning', block: 99, encoding_condition: "intentional"}},
		{word: 'REGEN', data: {trial_code: 'learning', block: 99, encoding_condition: "intentional"}},
		{word: 'ROCK', data: {trial_code: 'learning', block: 99, encoding_condition: "intentional"}},
		{word: 'SCHERE', data: {trial_code: 'learning', block: 99, encoding_condition: "intentional"}},
		{word: 'SCHLOSS', data: {trial_code: 'learning', block: 99, encoding_condition: "intentional"}},
		{word: 'SCHUH', data: {trial_code: 'learning', block: 99, encoding_condition: "intentional"}},
		{word: 'SESSEL', data: {trial_code: 'learning', block: 99, encoding_condition: "intentional"}},
		{word: 'STRASSE', data: {trial_code: 'learning', block: 99, encoding_condition: "intentional"}},
		{word: 'TAG', data: {trial_code: 'learning', block: 99, encoding_condition: "intentional"}},
		{word: 'TANTE', data: {trial_code: 'learning', block: 99, encoding_condition: "intentional"}},
	];
	words_learning_intentional = jsPsych.randomization.shuffle(words_learning_intentional) ;							// shuffle learning list

	// prepare list with buffer tasks (number of tasks needs to be dividable by three!)
	var math_tasks = [
		{task: '49 + 25 =', data: {trial_code: 'math_task', task: '49 + 25', answer: "74"}},
		{task: '86 + 12 =', data: {trial_code: 'math_task', task: '86 + 12', answer: "98"}},
		{task: '25 + 64 =', data: {trial_code: 'math_task', task: '25 + 64', answer: "89"}},
		{task: '34 + 51 =', data: {trial_code: 'math_task', task: '34 + 51', answer: "86"}},
		{task: '51 + 72 =', data: {trial_code: 'math_task', task: '51 + 72', answer: "123"}},
		{task: '13 + 86 =', data: {trial_code: 'math_task', task: '13 + 86', answer: "99"}},
		{task: '62 + 33 =', data: {trial_code: 'math_task', task: '62 + 33', answer: "95"}},
		{task: '78 + 47 =', data: {trial_code: 'math_task', task: '78 + 47', answer: "125"}},
		{task: '97 + 98 =', data: {trial_code: 'math_task', task: '97 + 98', answer: "195"}},
		{task: '26 + 39 =', data: {trial_code: 'math_task', task: '26 + 39', answer: "65"}},
		{task: '74 + 12 =', data: {trial_code: 'math_task', task: '74 + 12', answer: "86"}},
		{task: '61 + 93 =', data: {trial_code: 'math_task', task: '61 + 93', answer: "154"}},
		{task: '87 + 45 =', data: {trial_code: 'math_task', task: '87 + 45', answer: "132"}},
		{task: '58 + 86 =', data: {trial_code: 'math_task', task: '58 + 86', answer: "144"}},
		{task: '39 + 24 =', data: {trial_code: 'math_task', task: '39 + 24', answer: "63"}},
		{task: '21 - 19 =', data: {trial_code: 'math_task', task: '21 - 19', answer: "2"}},
		{task: '91 - 65 =', data: {trial_code: 'math_task', task: '91 - 65', answer: "26"}},
		{task: '62 - 58 =', data: {trial_code: 'math_task', task: '62 - 58', answer: "4"}},		
		{task: '85 - 16 =', data: {trial_code: 'math_task', task: '85 - 16', answer: "69"}},
		{task: '36 - 23 =', data: {trial_code: 'math_task', task: '36 - 23', answer: "13"}},
		{task: '43 - 24 =', data: {trial_code: 'math_task', task: '43 - 24 =', answer: "19"}},		
		{task: '73 - 39 =', data: {trial_code: 'math_task', task: '73 - 39', answer: "34"}},
		{task: '52 - 47 =', data: {trial_code: 'math_task', task: '52 - 47', answer: "5"}},
		{task: '45 - 37 =', data: {trial_code: 'math_task', task: '45 - 37', answer: "8"}},
		{task: '88 - 74 =', data: {trial_code: 'math_task', task: '88 - 74', answer: "14"}},
		{task: '34 - 31 =', data: {trial_code: 'math_task', task: '34 - 31', answer: "3"}},
		{task: '74 - 41 =', data: {trial_code: 'math_task', task: '74 - 41 =', answer: "33"}},		
		{task: '69 - 52 =', data: {trial_code: 'math_task', task: '69 - 52', answer: "17"}},
		{task: '96 - 48 =', data: {trial_code: 'math_task', task: '96 - 48', answer: "48"}},
		{task: '57 - 15 =', data: {trial_code: 'math_task', task: '57 - 15', answer: "42"}},	
	];
	math_tasks = jsPsych.randomization.shuffle(math_tasks) ;	
	
	// divide buffer tasks into 3 parts (one after each learning block)
	var math_tasks_slice1 = math_tasks.slice(0, math_tasks.length / 3);								// take 1st part
	var math_tasks_slice2 = math_tasks.slice(math_tasks.length / 3, (math_tasks.length / 3) * 2);	// 2nd part	
	var math_tasks_slice3 = math_tasks.slice((math_tasks.length / 3) * 2, math_tasks.length);		// 3rd part


	///////////////////////////////////////////////////////
	// prepare trials within secondary timelines
	
	// create fixation trial
	var fixation_trial = {
		type: 'html-keyboard-response',
    stimulus: '<div style="font-size:40px;">+</div>',
    choices: jsPsych.NO_KEYS,
		trial_duration: 1500,
		post_trial_gap: 0,
		data: {trial_code: 'fixation'}
    }

	// create intentional learning trial	
	var learning_trial_intentional = {
        type: 'html-keyboard-response',
		stimulus: jsPsych.timelineVariable('word'),
        choices: jsPsych.NO_KEYS,
		trial_duration: 2000,
        post_trial_gap: 0,
		data: jsPsych.timelineVariable('data'),
	};			
	
	// create incidental_semantic learning trial	
	var learning_trial_incidental_semantic = {
        type: 'html-keyboard-response',
		prompt: '<pre> lebendig										nicht lebendig </pre>',	// "<pre>" tag allows for predefined html text
		stimulus: jsPsych.timelineVariable('word'),
        choices: [37, 39], 								// left and right arrow key
		trial_duration: 2000,
        post_trial_gap: 0,
		data: jsPsych.timelineVariable('data'),
	};			

	// create incidental_perceptual learning trial	
	var learning_trial_incidental_perceptual = {
        type: 'html-keyboard-response',
		prompt: '<pre>"E"										"kein E" </pre>',
		stimulus: jsPsych.timelineVariable('word'),
        choices: [37, 39],								// left and right arrow key
		trial_duration: 2000,
        post_trial_gap: 0,
		data: jsPsych.timelineVariable('data'),
	};		

	// create buffer trial
	var math_trial = {
		type: 'survey-text',
		questions: [{prompt: jsPsych.timelineVariable('task'), rows: 1, columns: 5}],
		post_trial_gap: 0,
		data: jsPsych.timelineVariable('data'),
	};		

	// feedback trial
	var feedback_trial = {
		type: 'html-button-response',
		stimulus: '<p> Gut gemacht! Bereit für die nächste Aufgabe? </p>',
		choices: ['Los!']
	};
	
	///////////////////////////////////////////////////////
	// start the experiment

	var fullscreen_trial = {
		type: 'fullscreen',
		message: '',
		button_label: ['Start!'],
		fullscreen_mode: true,
	}
	timeline.push(fullscreen_trial);

	// welcome instruction
	var welcome_instruction_trial = {
		type: 'html-button-response',
		stimulus: '<p> Willkommen! <br> <br> Studie Tag 1 </p>',
		choices: ['Los!'],
		//data: {day: "day1"},
	};
	timeline.push(welcome_instruction_trial);

 	// subject ID
	var subject_id_trial = {
		type: 'survey-text',
		questions: [{prompt: "Bitte gib hier deinen persönlichen Probandencode ein. <br> Der Code setzt sich zusammen aus: <br> <br> - dem dritten Buchstaben des Vornamens deiner Mutter, <br> - dem dritten Buchstaben des Vornamens deines Vaters, <br> - dem dritten Buchstaben deines Geburtsortes, <br> - dem dritten Buchstaben der Straße, in der du wohnst, <br> - dem Tag deines Geburtstags. <br> <br> (z.B. <b>'GNRN02'</b> für 'Inge', 'Hans', 'Berlin', 'Sonnenallee', '02.05.1990') <br> ", rows: 1, columns: 8}],
		button_label: 'Ok!',
		data: {trial_code: "subject_id"},
		on_finish: function(data){
			subject_id = JSON.parse(data.responses).Q0;
			jsPsych.data.addProperties({
				subject_id: subject_id,
			});
		},		
	};
	timeline.push(subject_id_trial); 
 
 
	var interaction_data = jsPsych.data.getInteractionData();
	// log data to console in json format
	console.log(interaction_data.json());
 
	/*
	// age
	var survey_age_trial = {
		type: 'survey-text',
		button_label: 'Ok!',
		questions: [{prompt: "Alter:"},],
		data: {trial_code: "age"}, 
		on_finish: function(data){
			age = JSON.parse(data.responses).Q0;
			jsPsych.data.addProperties({
				age: age,
			});
		},	
	};		
	timeline.push(survey_age_trial); 
	
	// gender
	var survey_gender_trial = {
		type: 'survey-text',
		button_label: 'Ok!',
		questions: [{prompt: "Was ist dein Geschlecht?"},],
		data: {trial_code: "gender"}, 
		on_finish: function(data){
			gender = JSON.parse(data.responses).Q0;
			jsPsych.data.addProperties({
				gender: gender,
			});
		},	
	};
	timeline.push(survey_gender_trial); 
	
	// education
	var survey_education_trial = {
		type: 'survey-text',
		button_label: 'Ok!',
		questions: [{prompt: "Was ist dein höchster Bildungsabschluss?"},],
		data: {trial_code: "education"}, 
		on_finish: function(data){
			education = JSON.parse(data.responses).Q0;
			jsPsych.data.addProperties({
				education: education,
			});
		},	
	};
	timeline.push(survey_education_trial); 
	*/
	
	
	// initial feedback trial
	var initial_feedback_trial = {
		type: 'html-button-response',
		stimulus: '<p> Vielen Dank! <br> <br> Bereit für die erste Aufgabe? </p>',
		choices: ['Los!']
	};
	timeline.push(initial_feedback_trial);


	// start learning task blocks
	var block_counter																																		// counting variable needs to be defined out of the loop
	for (block_counter = 0; block_counter < encoding_condition_array.length; block_counter	 = block_counter + 1){
		
		// get the current block
		var current_block_condition = encoding_condition_array[block_counter];
		console.log("current_block: " + current_block_condition);
		
			if (current_block_condition == "incidental_semantic"){
			
					// update current word list with information on block and condition
					var i																																		// counting variable needs to be defined out of the loop
					for (i = 0; i < words_learning_incidental_semantic.length; i = i + 1){
						// words_learning_incidental_semantic[i]["data"]["encoding_condition"] = current_block_condition;		// can also be written as ...block1[1].data.encoding_condition
						words_learning_incidental_semantic[i]["data"]["block"] = block_counter + 1;
					};
					
					var learning_instruction_trial = {
						type: 'html-button-response',
						stimulus: 	'<p> <b>Aufgabe: Lebendig - Nicht lebendig</b> </p>' + 
									'<p> Dir werden nacheinander einige Wörter gezeigt. Entscheide für jedes Wort, ob das Wort ein Lebewesen oder ein nicht lebendes Objekt darstellt! </p>' + 
									'<p> <br> <br> Drücke die <b>linke Pfeiltaste</b> für lebendig. </p> <p> Drücke die <b>rechte Pfeiltaste</b> für nicht lebendig. </p>' +
									'<p> Antworte so schnell und so korrekt wie möglich! </p>',
						choices: ['Los!']
					};
					timeline.push(learning_instruction_trial);
			
					var learning_timeline = {												// learning task with own internal timeline (learning trial + fixation, defined above)
						timeline_variables: words_learning_incidental_semantic,
						randomize_order: true,
						timeline: [fixation_trial, learning_trial_incidental_semantic]	
					}	
					timeline.push(learning_timeline)
					
					timeline.push(feedback_trial);
					
					var math_instruction_trial = {
						type: 'html-button-response',
						stimulus: 	'<p> <b>Aufgabe: Rechnen</b> </p>' + 
									'<p> Dir werden nacheinander einige Rechenaufgaben gezeigt, deren Lösung du über die Tastatur eingeben kannst. </p>' + 
									'<p> Antworte so schnell und so korrekt wie möglich! </p>',
						choices: ['Los!']
					};
					timeline.push(math_instruction_trial);

					var math_timeline = {												// learning task with own internal timeline (learning trial + fixation, defined above)
						timeline_variables: math_tasks_slice1,
						randomize_order: true,
						timeline: [fixation_trial, math_trial]	
					}	
					timeline.push(math_timeline)
					
					// show feedback, except for the last block
					if (block_counter < 2){
						timeline.push(feedback_trial);
					};
			
			} else if (current_block_condition == "incidental_perceptual"){
			
					// update current word list slice with information on block and condition
					// somehow, this also updates the original learning list (maybe slice() does not create independent copies?)
					var i																																		// counting variable needs to be defined out of the loop
					for (i = 0; i < words_learning_incidental_perceptual.length; i = i + 1){
						words_learning_incidental_perceptual[i]["data"]["encoding_condition"] = current_block_condition;		// can also be written as ...block1[1].data.encoding_condition
						words_learning_incidental_perceptual[i]["data"]["block"] = block_counter + 1;
					};
					
					var learning_instruction_trial = {
						type: 'html-button-response',
						stimulus: 	'<p> <b>Aufgabe: E - kein E</b>  </p>' + 
									'<p> Dir werden nacheinander einige Wörter gezeigt. Entscheide für jedes Wort, ob das Wort ein "E" enthält oder nicht! </p>' + 
									'<p> <br> <br> Drücke die <b>linke Pfeiltaste</b>, wenn das Wort ein "E" enthält. </p> <p> Drücke die <b>rechte Pfeiltaste</b>, wenn das Wort kein "E" enthält. </p>' +
									'<p> Antworte so schnell und so korrekt wie möglich! </p>',
						choices: ['Los!']
					};
					timeline.push(learning_instruction_trial);

					var learning_timeline = {												// learning task with own internal timeline (learning trial + fixation, defined above)
						timeline_variables: words_learning_incidental_perceptual,
						randomize_order: true,
						timeline: [fixation_trial, learning_trial_incidental_perceptual]	
					}	
					timeline.push(learning_timeline)
					
					timeline.push(feedback_trial);
					
					var math_instruction_trial = {
						type: 'html-button-response',
						stimulus: 	'<p> <b>Aufgabe: Rechnen</b>  </p>' + 
									'<p> Dir werden nacheinander einige Rechenaufgaben gezeigt, deren Lösung du über die Tastatur eingeben kannst. </p>' + 
									'<p> Antworte so schnell und so korrekt wie möglich! </p>',
						choices: ['Los!']
					};
					timeline.push(math_instruction_trial);

					var math_timeline = {												// learning task with own internal timeline (learning trial + fixation, defined above)
						timeline_variables: math_tasks_slice2,
						randomize_order: true,
						timeline: [fixation_trial, math_trial]	
					}	
					timeline.push(math_timeline)			
					
					// show feedback, except for the last block
					if (block_counter < 2){
						timeline.push(feedback_trial);
					};

			} else if (current_block_condition == "intentional"){

					// update current word list slice with information on block and condition
					// somehow, this also updates the original learning list (maybe slice() does not create independent copies?)
					var i																																		// counting variable needs to be defined out of the loop
					for (i = 0; i < words_learning_intentional.length; i = i + 1){
						words_learning_intentional[i]["data"]["encoding_condition"] = current_block_condition;		// can also be written as ...block1[1].data.encoding_condition
						words_learning_intentional[i]["data"]["block"] = block_counter + 1;
					};
					
					var learning_instruction_trial = {
						type: 'html-button-response',
						stimulus: 	'<p> <b>Aufgabe: Wörter lernen</b> </p>' + 
									'<p> Dir werden nacheinander einige Wörter gezeigt. Versuche dir jedes Wort so gut wie möglich zu merken! </p>',
						choices: ['Los!']
					};
					timeline.push(learning_instruction_trial);
					
					var learning_timeline = {												// learning task with own internal timeline (learning trial + fixation, defined above)
						timeline_variables: words_learning_intentional,
						randomize_order: true,
						timeline: [fixation_trial, learning_trial_intentional]	
					}	
					timeline.push(learning_timeline)
					
					timeline.push(feedback_trial);
					
					var math_instruction_trial = {
						type: 'html-button-response',
						stimulus: 	'<p> <b>Aufgabe: Rechnen</b>  </p>' + 
									'<p> Dir werden nacheinander einige Rechenaufgaben gezeigt, deren Lösung du über die Tastatur eingeben kannst. </p>' + 
									'<p> Antworte so schnell und so korrekt wie möglich! </p>',
						choices: ['Los!']
					};
					timeline.push(math_instruction_trial);

					var math_timeline = {												// learning task with own internal timeline (learning trial + fixation, defined above)
						timeline_variables: math_tasks_slice3,
						randomize_order: true,
						timeline: [fixation_trial, math_trial]	
					}	
					timeline.push(math_timeline)	
					
					// show feedback, except for the last block
					if (block_counter < 2){
						timeline.push(feedback_trial);
					};
			}

	} // end learning block loop



	// add a STM recall, if condition == STM
	if (rehearsal_condition == "STM"){

			timeline.push(feedback_trial);
			
			var recall_instruction_trial = {				//  recall instruction
				type: 'html-button-response',
				stimulus: '<p> In dieser Aufgabe sollst du dich an ALLE Wörter erinnern, die du gerade gesehen hast. Versuche dich auch an die Wörter zu erinnern, die du nicht ausdrücklich lernen solltest! </p>' + '<p> </p>',
				choices: ['Los!'],
			};
			timeline.push(recall_instruction_trial);

			// recall task
			var recall_trial = {		
				type: 'survey-text',
				questions: [{prompt: "Bitte notiere ALLE Wörter, an die du dich noch erinnern kannst! Trenne jedes neue Wort durch ein Komma (Wort1, Wort2, ...).", rows: 20, columns: 80}],
				data: {trial_code: "LTM_recall"}, 
			};
			timeline.push(recall_trial); 
	}

	// end trial
	var end_trial = {
		type: 'html-button-response',
		stimulus: '<p> Gut gemacht, vielen Dank!  <br> <br> Ende des Experiments! Bitte bei der Versuchsleiterin melden. </p>',
		choices: ['Ok!']
	};
	timeline.push(end_trial);
   
   
   
	/////////////////////////////////////////////////////
	// starts playing the timeline
	jsPsych.init({
		timeline: timeline,
		on_finish: function() {jsPsych.data.displayData('csv');},					// displays data at the end
	});

  
</script>

</html>