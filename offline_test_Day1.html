<!DOCTYPE html>

<html lang="de">

<head>

  <meta charset="UTF-8"/>
  
  <!-- name of experiment -->
  <title>offline_test_Day1</title>  
  
  <!-- loads jspsych plugins (offline) -->
  <script type="text/javascript" src="jspsych-6.0.5/jspsych.js"></script>
  <link rel="stylesheet" type="text/css" href="jspsych-6.0.5/css/jspsych.css"/>
  <script type="text/javascript" src="jspsych-6.0.5/plugins/jspsych-html-keyboard-response.js"></script>
  <script type="text/javascript" src="jspsych-6.0.5/plugins/jspsych-image-keyboard-response.js"></script>
	<script type="text/javascript" src="jspsych-6.0.5/plugins/jspsych-html-button-response.js"></script>
	<script type="text/javascript" src="jspsych-6.0.5/plugins/jspsych-html-keyboard-response.js"></script>
	<script type="text/javascript" src="jspsych-6.0.5/plugins/jspsych-fullscreen.js"></script>
  <script src="jspsych-6.0.5/plugins/jspsych-survey-text.js"></script> 

</head>



<!-- this is the Javascript section -->
<script>
  


	///////////////////////////////////////////////////////
	// define variables

	// create timeline
	var timeline = [];

	var console_test = "go console!";
	console.log(console_test);
  
	// create encoding condition variable
	var encoding_condition_array = ["incidental_semantic", "incidental_perceptual", "intentional"]
	encoding_condition_array = jsPsych.randomization.shuffle(encoding_condition_array)    // shuffle array
	

	// create rehearsal condition variable
	var rehearsal_condition_array = ["STM", "noSTM"]
	rehearsal_condition_array = jsPsych.randomization.shuffle(rehearsal_condition_array)    // shuffle array
	
	var rehearsal_condition = rehearsal_condition_array[0]      // get first element
	jsPsych.data.addProperties({rehearsal_condition: rehearsal_condition});	// adds condition variable to all trials in the data
	console.log("rehearsal_condition: " + rehearsal_condition);


	// prepare learning lists for the three conditions
	var words_learning_incidental_semantic = [
		{word: 'MÄDCHEN', data: {trial_code: 'learning', block: 99, encoding_condition: "none", target: "living"}},
		{word: 'RAUPE', data: {trial_code: 'learning', block: 99, encoding_condition: "none", target: "living"}},
		{word: 'BAUM', data: {trial_code: 'learning', block: 99, encoding_condition: "none", target: "living"}},
		{word: 'GABEL', data: {trial_code: 'learning', block: 99, encoding_condition: "none", target: "non_living"}},
		{word: 'RADIO', data: {trial_code: 'learning', block: 99, encoding_condition: "none", target: "non_living"}},
		{word: 'BROT', data: {trial_code: 'learning', block: 99, encoding_condition: "none", target: "non_living"}},
	];
	words_learning_incidental_semantic = jsPsych.randomization.shuffle(words_learning_incidental_semantic) ;			// shuffle learning list
	
	var words_learning_incidental_perceptual = [
		{word: 'STRAUCH', data: {trial_code: 'learning', block: 99, encoding_condition: "none", target: "no_e"}},
		{word: 'KÖNIG', data: {trial_code: 'learning', block: 99, encoding_condition: "none", target: "no_e"}},
		{word: 'PILZ', data: {trial_code: 'learning', block: 99, encoding_condition: "none", target: "no_e"}},
		{word: 'ENTE', data: {trial_code: 'learning', block: 99, encoding_condition: "none", target: "e"}},
		{word: 'FREUND', data: {trial_code: 'learning', block: 99, encoding_condition: "none", target: "e"}},
		{word: 'FEUER', data: {trial_code: 'learning', block: 99, encoding_condition: "none", target: "e"}},
	];
	words_learning_incidental_perceptual = jsPsych.randomization.shuffle(words_learning_incidental_perceptual) ;		// shuffle learning list
	
	var words_learning_intentional = [
		{word: 'SCHUH', data: {trial_code: 'learning', block: 99, encoding_condition: "none"}},
		{word: 'KATZE', data: {trial_code: 'learning', block: 99, encoding_condition: "none"}},
		{word: 'HUND', data: {trial_code: 'learning', block: 99, encoding_condition: "none"}},
		{word: 'SCHLOSS', data: {trial_code: 'learning', block: 99, encoding_condition: "none"}},
		{word: 'BRILLE', data: {trial_code: 'learning', block: 99, encoding_condition: "none"}},
		{word: 'WOLF', data: {trial_code: 'learning', block: 99, encoding_condition: "none"}},
	];
	words_learning_intentional = jsPsych.randomization.shuffle(words_learning_intentional) ;							// shuffle learning list

	// prepare list with buffer tasks
	var math_tasks = [
		{task: '16 * 12 =', data: {trial_code: 'math_task', block: 99, task: '16 * 12 =', answer: "192"}},
		{task: '8 * 14 =', data: {trial_code: 'math_task', block: 99, task: '8 * 14 =', answer: "112"}},
		{task: '17 * 3 =', data: {trial_code: 'math_task', block: 99, task: '17 * 3 =', answer: "51"}},
		{task: '3 * 36 =', data: {trial_code: 'math_task', block: 99, task: '3 * 36 =', answer: "108"}},
		{task: '7 * 16 =', data: {trial_code: 'math_task', block: 99, task: '7 * 16 =', answer: "112"}},
		{task: '18 * 6 =', data: {trial_code: 'math_task', block: 99, task: '18 * 6 =', answer: "108"}},
	];
	math_tasks = jsPsych.randomization.shuffle(math_tasks) ;	
	
	// divide buffer tasks into 3 parts (one after each learning block)
	var math_tasks_slice1 = math_tasks.slice(0, math_tasks.length / 3);								// take 1st part
	var math_tasks_slice2 = math_tasks.slice(math_tasks.length / 3, (math_tasks.length / 3) * 2);	// 2nd part	
	var math_tasks_slice3 = math_tasks.slice((math_tasks.length / 3) * 2, math_tasks.length);		// 3rd part


	///////////////////////////////////////////////////////
	// prepare trials within secondary timelines
	
	// create fixation trial
	var fixation_trial = {
		type: 'html-keyboard-response',
    stimulus: '<div style="font-size:60px;">+</div>',
    choices: jsPsych.NO_KEYS,
		trial_duration: 1500,
		post_trial_gap: 0,
		data: {trial_code: 'fixation'}
    }

	// create intentional learning trial	
	var learning_trial_intentional = {
        type: 'html-keyboard-response',
		stimulus: jsPsych.timelineVariable('word'),
        choices: jsPsych.NO_KEYS,
		trial_duration: 2000,
        post_trial_gap: 0,
		data: jsPsych.timelineVariable('data'),
	};			
	
	// create incidental_semantic learning trial	
	var learning_trial_incidental_semantic = {
        type: 'html-keyboard-response',
		stimulus: jsPsych.timelineVariable('word'),
        choices: ["l", "n"],
		// prompt: "<p> <br> <br> Drücke 'L' für lebendig </p> <p> Drücke 'N' für nicht lebendig </p>", 
		trial_duration: 2000,
        post_trial_gap: 0,
		data: jsPsych.timelineVariable('data'),
	};			

	// create incidental_perceptual learning trial	
	var learning_trial_incidental_perceptual = {
        type: 'html-keyboard-response',
		stimulus: jsPsych.timelineVariable('word'),
        choices: ["e", "n"],
		// prompt: "<p> <br> <br> Drücke 'E' wenn das Wort ein 'E' enthält </p> <p> Drücke 'N' wenn das Wort kein 'E' enthält. </p>", 
		trial_duration: 2000,
        post_trial_gap: 0,
		data: jsPsych.timelineVariable('data'),
	};		

	// create buffer trial
	var math_trial = {
		type: 'survey-text',
		questions: [{prompt: jsPsych.timelineVariable('task'), rows: 1, columns: 5}],
		post_trial_gap: 0,
		data: jsPsych.timelineVariable('data'),
	};		

	// feedback trial
	var feedback_trial = {
		type: 'html-button-response',
		stimulus: '<p> Gut gemacht! Bereit für die nächste Aufgabe? </p>',
		choices: ['Los!']
	};





	///////////////////////////////////////////////////////
	// start the experiment

	var fullscreen_trial = {
		type: 'fullscreen',
		message: '',
		button_label: ['Start and enter fullscreen mode'],
		fullscreen_mode: true,
	}
	timeline.push(fullscreen_trial);

	// welcome instruction
	var welcome_instruction_trial = {
		type: 'html-button-response',
		stimulus: '<p> Willkommen! <br> <br> Ankas & Lindas coole Masterarbeit, Tag 1 </p>',
		choices: ['Los!']
	};
	timeline.push(welcome_instruction_trial);

 	// subject ID
	var subject_id_trial = {
		type: 'survey-text',
		questions: [{prompt: "Bitte gib deinen persönlichen Probandencode ein:"}],
	};
	timeline.push(subject_id_trial); 
 
	// biographic data
	var survey_trial = {
		type: 'survey-text',
		questions: [{prompt: "Wie alt bist du?"}, {prompt: "Was ist dein Geschlecht?"}, {prompt: "Was ist dein höchster Bildungsabschluss?"},],
	};
	timeline.push(survey_trial); 

	// initial feedback trial
	var initial_feedback_trial = {
		type: 'html-button-response',
		stimulus: '<p> Vielen Dank! <br> <br> Bereit für die erste Aufgabe? </p>',
		choices: ['Los!']
	};
	timeline.push(initial_feedback_trial);


	// start learning task blocks
	var block_counter																																		// counting variable needs to be defined out of the loop
	for (block_counter = 0; block_counter < encoding_condition_array.length; block_counter	 = block_counter + 1){
		
		// get the current block
		var current_block_condition = encoding_condition_array[block_counter];
		console.log("current_block: " + current_block_condition);
		
			if (current_block_condition == "incidental_semantic"){
			
					// update current word list slice with information on block and condition
					// somehow, this also updates the original learning list (maybe slice() does not create independent copies?)
					var i																																		// counting variable needs to be defined out of the loop
					for (i = 0; i < words_learning_incidental_semantic.length; i = i + 1){
						words_learning_incidental_semantic[i]["data"]["encoding_condition"] = current_block_condition;		// can also be written as ...block1[1].data.encoding_condition
						words_learning_incidental_semantic[i]["data"]["block"] = block_counter + 1;
					};
					
					var learning_instruction_trial = {
						type: 'html-button-response',
						stimulus: 	'<p> Aufgabe: Lebendig - Nicht lebendig  </p>' + 
									'<p> Dir werden nacheinander einige Wörter gezeigt. Entscheide für jedes Wort, ob das Wort ein Lebewesen oder ein nicht lebendes Objekt darstellt! </p>' + 
									'<p> <br> <br> Drücke "Y" für lebendig </p> <p> Drücke "N" für nicht lebendig </p>' +
									'<p> Antworte so schnell und so korrekt wie möglich! </p>',
						choices: ['Los!']
					};
					timeline.push(learning_instruction_trial);
			
					var learning_timeline = {												// learning task with own internal timeline (learning trial + fixation, defined above)
						timeline_variables: words_learning_incidental_semantic,
						randomize_order: true,
						timeline: [fixation_trial, learning_trial_incidental_semantic]	
					}	
					timeline.push(learning_timeline)
					
					timeline.push(feedback_trial);
					
					var math_instruction_trial = {
						type: 'html-button-response',
						stimulus: 	'<p> Aufgabe: Rechnen  </p>' + 
									'<p> Dir werden nacheinander einige Rechenaufgaben gezeigt, deren Lösung du über die Tastatur eingeben kannst. </p>' + 
									'<p> Antworte so schnell und so korrekt wie möglich! </p>',
						choices: ['Los!']
					};
					timeline.push(math_instruction_trial);

					var math_timeline = {												// learning task with own internal timeline (learning trial + fixation, defined above)
						timeline_variables: math_tasks_slice1,
						randomize_order: true,
						timeline: [fixation_trial, math_trial]	
					}	
					timeline.push(math_timeline)
					
					// show feedback, except for the last block
					if (block_counter < 2){
						timeline.push(feedback_trial);
					};
			
			} else if (current_block_condition == "incidental_perceptual"){
			
					// update current word list slice with information on block and condition
					// somehow, this also updates the original learning list (maybe slice() does not create independent copies?)
					var i																																		// counting variable needs to be defined out of the loop
					for (i = 0; i < words_learning_incidental_perceptual.length; i = i + 1){
						words_learning_incidental_perceptual[i]["data"]["encoding_condition"] = current_block_condition;		// can also be written as ...block1[1].data.encoding_condition
						words_learning_incidental_perceptual[i]["data"]["block"] = block_counter + 1;
					};
					
					var learning_instruction_trial = {
						type: 'html-button-response',
						stimulus: 	'<p> Aufgabe: E - kein E  </p>' + 
									'<p> Dir werden nacheinander einige Wörter gezeigt. Entscheide für jedes Wort, ob das Wort ein "E" oder ein nicht lebendes Objekt darstellt! </p>' + 
									'<p> <br> <br> Drücke "Y" wenn das Wort ein "E" enthält </p> <p> Drücke "N" wenn das Wort kein "E" enthält. </p>' +
									'<p> Antworte so schnell und so korrekt wie möglich! </p>',
						choices: ['Los!']
					};
					timeline.push(learning_instruction_trial);

					var learning_timeline = {												// learning task with own internal timeline (learning trial + fixation, defined above)
						timeline_variables: words_learning_incidental_perceptual,
						randomize_order: true,
						timeline: [fixation_trial, learning_trial_incidental_perceptual]	
					}	
					timeline.push(learning_timeline)
					
					timeline.push(feedback_trial);
					
					var math_instruction_trial = {
						type: 'html-button-response',
						stimulus: 	'<p> Aufgabe: Rechnen  </p>' + 
									'<p> Dir werden nacheinander einige Rechenaufgaben gezeigt, deren Lösung du über die Tastatur eingeben kannst. </p>' + 
									'<p> Antworte so schnell und so korrekt wie möglich! </p>',
						choices: ['Los!']
					};
					timeline.push(math_instruction_trial);

					var math_timeline = {												// learning task with own internal timeline (learning trial + fixation, defined above)
						timeline_variables: math_tasks_slice2,
						randomize_order: true,
						timeline: [fixation_trial, math_trial]	
					}	
					timeline.push(math_timeline)			
					
					// show feedback, except for the last block
					if (block_counter < 2){
						timeline.push(feedback_trial);
					};

			} else if (current_block_condition == "intentional"){

					// update current word list slice with information on block and condition
					// somehow, this also updates the original learning list (maybe slice() does not create independent copies?)
					var i																																		// counting variable needs to be defined out of the loop
					for (i = 0; i < words_learning_intentional.length; i = i + 1){
						words_learning_intentional[i]["data"]["encoding_condition"] = current_block_condition;		// can also be written as ...block1[1].data.encoding_condition
						words_learning_intentional[i]["data"]["block"] = block_counter + 1;
					};
					
					var learning_instruction_trial = {
						type: 'html-button-response',
						stimulus: 	'<p> Aufgabe: Wörter lernen </p>' + 
									'<p> Dir werden nacheinander einige Wörter gezeigt. Versuche dir jedes Wort so gut wie möglich zu merken! </p>',
						choices: ['Los!']
					};
					timeline.push(learning_instruction_trial);
					
					var learning_timeline = {												// learning task with own internal timeline (learning trial + fixation, defined above)
						timeline_variables: words_learning_intentional,
						randomize_order: true,
						timeline: [fixation_trial, learning_trial_intentional]	
					}	
					timeline.push(learning_timeline)
					
					timeline.push(feedback_trial);
					
					var math_instruction_trial = {
						type: 'html-button-response',
						stimulus: 	'<p> Aufgabe: Rechnen  </p>' + 
									'<p> Dir werden nacheinander einige Rechenaufgaben gezeigt, deren Lösung du über die Tastatur eingeben kannst. </p>' + 
									'<p> Antworte so schnell und so korrekt wie möglich! </p>',
						choices: ['Los!']
					};
					timeline.push(math_instruction_trial);

					var math_timeline = {												// learning task with own internal timeline (learning trial + fixation, defined above)
						timeline_variables: math_tasks_slice3,
						randomize_order: true,
						timeline: [fixation_trial, math_trial]	
					}	
					timeline.push(math_timeline)	
					
					// show feedback, except for the last block
					if (block_counter < 2){
						timeline.push(feedback_trial);
					};
			}

	} // end learning block loop



	// add a STM recall, if condition == STM
	if (rehearsal_condition == "STM"){

			timeline.push(feedback_trial);
			
			var recall_instruction_trial = {				//  recall instruction
				type: 'html-button-response',
				stimulus: '<p> In der dieser Aufgabe sollst du dich an alle Wörter zu erinnern, die du gerade gesehen hast. Versuche dich auch an die Wörter zu erinnern, die du nicht ausdrücklich lernen solltest! </p>' + '<p> </p>',
				choices: ['Los!']
			};
			timeline.push(recall_instruction_trial);

			var recall_trial = {										// recall task
				type: 'survey-text',
				questions: [{prompt: "Bitte notiere alle Wörter, an die du dich noch erinnern kannst. Schreibe dabei jedes Wort in eine neue Zeile und achte darauf, dass es richtig geschrieben ist.", rows: 20, columns: 40}],
			};
			timeline.push(recall_trial); 
	}

	// end trial
	var end_trial = {
		type: 'html-button-response',
		stimulus: '<p> Gut gemacht <br> <br> Vielen Dank! Ende des Experiments! </p>',
		choices: ['Ok!']
	};
	timeline.push(end_trial);
   


		
	///////////////////////////////////////////////////////
	// start experiment

	// starts playing the timeline
	jsPsych.init({
		timeline: timeline,
		on_finish: function() {jsPsych.data.displayData('csv');},					// displays data at the end
	});

  
</script>

</html>